import React from 'react'
import ReactDom from 'react-dom'
import {Provider, connect} from "react-redux"
import {store, addMessage} from "./index.js"

class InputMessage extends React.Component {
    constructor(props){
        super(props)
        this.state  = ({name: '', message: ''})
        this.clearMessage = this.clearMessage.bind(this)
        this.changeState = this.changeState.bind(this)
        this.submitMessage = this.submitMessage.bind(this)
    }

    changeState(event){
        this.setState({[event.target.name]: event.target.value})
        console.log(event.target.name, event.target.value)
    }

    clearMessage(){
        this.setState({name: '', message: ''})
    }

    submitMessage(){
        let  messageData = {
            key: '',
            name: this.state.name,
            message: this.state.message
        }
        this.props.addMessage(messageData)
        this.clearMessage
    }

    render(){
        return(
            <div>
                name: <input type='text' name="name"
                             value={this.state.name}
                             onChange={this.changeState} />
                <br/>
                Message:
                <br/>
                <textarea   name="message"
                            value={this.state.message}
                            onChange={this.changeState}>
                </textarea>
                <input type='button' value='send' onClick={this.submitMessage} />
            </div>
        )
    }
}

class MessageList extends React.Component{
    render(){
        let message = this.props.data.map((item)=>{
            return <li>{item.name}ï¼š{item.message}</li>
        })
        return (
            <ul>
                {message}
            </ul>
        )
    }
}


const mapStatetoProp = state => {
    return {data: state.message}
}

const mapDispatchtoProp = dispatch => {
    return {
        addMessage: article => dispatch(addMessage(article))
    }
}


class ConnectMessageForm extends React.Component {
    render(){
        return(
            <div>
                <InputMessage addMessage={this.props.addMessage} />
                <MessageList data={this.props.data} />
            </div>
        )
    }
}

const MessageForm = connect(mapStatetoProp, mapDispatchtoProp)(ConnectMessageForm)

ReactDom.render(<Provider store={store}>
                    <MessageForm />
                </Provider>, document.getElementById('root'))